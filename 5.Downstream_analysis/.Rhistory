<<<<<<< HEAD
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
library(org.Hs.eg.db)
dir_rna = dir(paste0(path_use,i,'/rna_snp'))
dir_atac = dir(paste0(path_use,i,'/atac_snp'))
dir.create(paste0(path_use,i,'/rna_enrich_kegg'))
dir.create(paste0(path_use,i,'/rna_enrich_go'))
dir.create(paste0(path_use,i,'/atac_enrich_kegg'))
dir.create(paste0(path_use,i,'/atac_enrich_go'))
for (j in dir_rna) {
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
enrich_plot = plot_enrich(snp_rna$symbol)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/rna_enrich_kegg/',name_disease,'_kegg.svg')
go_path = paste0(path_use,i,'/rna_enrich_go/',name_disease,'_go.svg')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 4, height = 4)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 4, height = 4)
print(dotplot(enrich_plot$go))
dev.off()
}
}
for (j in dir_atac) {
snp_atac = read.delim(paste0(path_use,i,'/atac_snp/',j))
snp_atac[,1] = paste0('chr',snp_atac[,1])
peaks = GenomicRanges::GRanges(paste0(snp_atac[,1],':',
snp_atac[,2],'-',
snp_atac[,3]))
peakAnno <- ChIPseeker::annotatePeak(peaks,
tssRegion = c(-3000, 3000),
TxDb = txdb, annoDb = 'org.Hs.eg.db')
enrich_plot = plot_enrich(peakAnno@anno$SYMBOL)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/atac_enrich_kegg/',name_disease,'_kegg.tiff')
go_path = paste0(path_use,i,'/atac_enrich_go/',name_disease,'_go.tiff')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 4, height = 4)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 4, height = 4)
print(dotplot(enrich_plot$go))
dev.off()
}
}
}
### cell type specific grn
if (grn) {
print('plot grn!!')
dir.create(paste0(path_use,i,'/grn_cor02_fig'))
dir.create(paste0(path_use,i,'/grn_cor04_fig'))
grn02_path = dir(paste0(path_use,i,'/grn_cor02'))
grn04_path = dir(paste0(path_use,i,'/grn_cor04'))
for (j in grn02_path) {
grn_name = unlist(strsplit(j,'.txt'))
data = read.table(paste0(path_use,i,'/grn_cor02/',j),header = T)
data$type = ifelse(data$value>0,'positive','negative')
if (nrow(data)>=1) {
outpath = paste0(path_use,i,'/grn_cor02_fig/',grn_name,'.tiff')
tiff(filename = outpath, width = 15000, height = 12000, units = "px", res = 1200, compression = "lzw")
print(plot_grn_irena(data))
dev.off()
}
}
for (j in grn04_path) {
grn_name = unlist(strsplit(j,'.txt'))
data = read.table(paste0(path_use,i,'/grn_cor04/',j),header = T)
data$type = ifelse(data$value>0,'positive','negative')
if (nrow(data)>=1) {
outpath = paste0(path_use,i,'/grn_cor04_fig/',grn_name,'.tiff')
tiff(filename = outpath, width = 15000, height = 12000, units = "px", res = 1200, compression = "lzw")
print(plot_grn_irena(data))
dev.off()
}
}
}
}
}
plot_main(grn=F)
plot_main('E:\\DRCTdb\\ignore\\downstream_result',grn=F)
plot_main('E:\\DRCTdb\\ignore\\downstream_result/',grn=F)
plot_main('E:\\DRCTdb\\ignore\\downstream_result/',grn=F)
path_use=''E:\\DRCTdb\\ignore\\downstream_result/''
path_use='E:\\DRCTdb\\ignore\\downstream_result/'
library(ChIPseeker)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
library(org.Hs.eg.db)
dir_rna = dir(paste0(path_use,i,'/rna_snp'))
dir_atac = dir(paste0(path_use,i,'/atac_snp'))
dir.create(paste0(path_use,i,'/rna_enrich_kegg'))
dir.create(paste0(path_use,i,'/rna_enrich_go'))
dir.create(paste0(path_use,i,'/atac_enrich_kegg'))
dir.create(paste0(path_use,i,'/atac_enrich_go'))
for (j in dir_rna) {
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
enrich_plot = plot_enrich(snp_rna$symbol)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/rna_enrich_kegg/',name_disease,'_kegg.svg')
go_path = paste0(path_use,i,'/rna_enrich_go/',name_disease,'_go.svg')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 4, height = 4)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 4, height = 4)
print(dotplot(enrich_plot$go))
dev.off()
}
}
snp_rna
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
dir.create(paste0(path_use,i,'/atac_enrich_go'))
path_use
dir_rna
dir_rna = dir(paste0(path_use,i,'/rna_snp'))
i=dir1[1]
dir1 = dir(path_use)
i=dir1[1]
dir_rna = dir(paste0(path_use,i,'/rna_snp'))
dir_atac = dir(paste0(path_use,i,'/atac_snp'))
dir.create(paste0(path_use,i,'/rna_enrich_kegg'))
dir.create(paste0(path_use,i,'/rna_enrich_go'))
dir.create(paste0(path_use,i,'/atac_enrich_kegg'))
dir.create(paste0(path_use,i,'/atac_enrich_go'))
j=dir_rna[1]
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
enrich_plot = plot_enrich(snp_rna$symbol)
name_disease = unlist(strsplit(j,'.txt'))
enrich_plot = plot_enrich(snp_rna$symbol)
plot_enrich <- function(gene1){
library(clusterProfiler)
library(org.Hs.eg.db)
entrez_id <- bitr(gene1,
fromType = "SYMBOL",
toType = "ENTREZID",
OrgDb = org.Hs.eg.db)
gene_universe <- names(org.Hs.eg.db)
enrich_go <- enrichGO(gene = entrez_id$ENTREZID,
keyType = 'ENTREZID',
OrgDb = org.Hs.eg.db)
p_go = dotplot(enrich_go)
enrich_kegg <- enrichKEGG(gene = entrez_id$ENTREZID,
organism = 'hsa',use_internal_data = T)
p_kegg = dotplot(enrich_kegg)
list1 = list(enrich_go,enrich_kegg)
names(list1) = c('go','kegg')
return(list1)
}
plot_main <- function(path_use,enrich=T,grn=T){
dir1 = dir(path_use)
for (i in dir1) {
### kegg go plot
if (enrich) {
library(ChIPseeker)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
library(org.Hs.eg.db)
dir_rna = dir(paste0(path_use,i,'/rna_snp'))
dir_atac = dir(paste0(path_use,i,'/atac_snp'))
dir.create(paste0(path_use,i,'/rna_enrich_kegg'))
dir.create(paste0(path_use,i,'/rna_enrich_go'))
dir.create(paste0(path_use,i,'/atac_enrich_kegg'))
dir.create(paste0(path_use,i,'/atac_enrich_go'))
for (j in dir_rna) {
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
enrich_plot = plot_enrich(snp_rna$symbol)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/rna_enrich_kegg/',name_disease,'_kegg.svg')
go_path = paste0(path_use,i,'/rna_enrich_go/',name_disease,'_go.svg')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 4, height = 4)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 4, height = 4)
print(dotplot(enrich_plot$go))
dev.off()
}
}
for (j in dir_atac) {
snp_atac = read.delim(paste0(path_use,i,'/atac_snp/',j))
snp_atac[,1] = paste0('chr',snp_atac[,1])
peaks = GenomicRanges::GRanges(paste0(snp_atac[,1],':',
snp_atac[,2],'-',
snp_atac[,3]))
peakAnno <- ChIPseeker::annotatePeak(peaks,
tssRegion = c(-3000, 3000),
TxDb = txdb, annoDb = 'org.Hs.eg.db')
enrich_plot = plot_enrich(peakAnno@anno$SYMBOL)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/atac_enrich_kegg/',name_disease,'_kegg.tiff')
go_path = paste0(path_use,i,'/atac_enrich_go/',name_disease,'_go.tiff')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 4, height = 4)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 4, height = 4)
print(dotplot(enrich_plot$go))
dev.off()
}
}
}
### cell type specific grn
if (grn) {
print('plot grn!!')
dir.create(paste0(path_use,i,'/grn_cor02_fig'))
dir.create(paste0(path_use,i,'/grn_cor04_fig'))
grn02_path = dir(paste0(path_use,i,'/grn_cor02'))
grn04_path = dir(paste0(path_use,i,'/grn_cor04'))
for (j in grn02_path) {
grn_name = unlist(strsplit(j,'.txt'))
data = read.table(paste0(path_use,i,'/grn_cor02/',j),header = T)
data$type = ifelse(data$value>0,'positive','negative')
if (nrow(data)>=1) {
outpath = paste0(path_use,i,'/grn_cor02_fig/',grn_name,'.tiff')
tiff(filename = outpath, width = 15000, height = 12000, units = "px", res = 1200, compression = "lzw")
print(plot_grn_irena(data))
dev.off()
}
}
for (j in grn04_path) {
grn_name = unlist(strsplit(j,'.txt'))
data = read.table(paste0(path_use,i,'/grn_cor04/',j),header = T)
data$type = ifelse(data$value>0,'positive','negative')
if (nrow(data)>=1) {
outpath = paste0(path_use,i,'/grn_cor04_fig/',grn_name,'.tiff')
tiff(filename = outpath, width = 15000, height = 12000, units = "px", res = 1200, compression = "lzw")
print(plot_grn_irena(data))
dev.off()
}
}
}
}
}
plot_main(grn=F)
plot_main(path_use,grn=F)
plot_main <- function(path_use,enrich=T,grn=T){
dir1 = dir(path_use)
for (i in dir1) {
### kegg go plot
if (enrich) {
library(ChIPseeker)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
library(org.Hs.eg.db)
dir_rna = dir(paste0(path_use,i,'/rna_snp'))
dir_atac = dir(paste0(path_use,i,'/atac_snp'))
dir.create(paste0(path_use,i,'/rna_enrich_kegg'))
dir.create(paste0(path_use,i,'/rna_enrich_go'))
dir.create(paste0(path_use,i,'/atac_enrich_kegg'))
dir.create(paste0(path_use,i,'/atac_enrich_go'))
for (j in dir_rna) {
snp_rna = read.delim(paste0(path_use,i,'/rna_snp/',j))
enrich_plot = plot_enrich(snp_rna$symbol)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/rna_enrich_kegg/',name_disease,'_kegg.svg')
go_path = paste0(path_use,i,'/rna_enrich_go/',name_disease,'_go.svg')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 8, height = 8)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 8, height = 8)
print(dotplot(enrich_plot$go))
dev.off()
}
}
for (j in dir_atac) {
snp_atac = read.delim(paste0(path_use,i,'/atac_snp/',j))
snp_atac[,1] = paste0('chr',snp_atac[,1])
peaks = GenomicRanges::GRanges(paste0(snp_atac[,1],':',
snp_atac[,2],'-',
snp_atac[,3]))
peakAnno <- ChIPseeker::annotatePeak(peaks,
tssRegion = c(-3000, 3000),
TxDb = txdb, annoDb = 'org.Hs.eg.db')
enrich_plot = plot_enrich(peakAnno@anno$SYMBOL)
name_disease = unlist(strsplit(j,'.txt'))
kegg_path = paste0(path_use,i,'/atac_enrich_kegg/',name_disease,'_kegg.tiff')
go_path = paste0(path_use,i,'/atac_enrich_go/',name_disease,'_go.tiff')
if (dim(enrich_plot$kegg)[1]>1) {
svg(filename = kegg_path, width = 8, height = 8)
print(dotplot(enrich_plot$kegg))
dev.off()
}
if (dim(enrich_plot$go)[1]>1) {
svg(filename = go_path, width = 8, height = 8)
print(dotplot(enrich_plot$go))
dev.off()
}
}
}
### cell type specific grn
if (grn) {
print('plot grn!!')
dir.create(paste0(path_use,i,'/grn_cor02_fig'))
dir.create(paste0(path_use,i,'/grn_cor04_fig'))
grn02_path = dir(paste0(path_use,i,'/grn_cor02'))
grn04_path = dir(paste0(path_use,i,'/grn_cor04'))
for (j in grn02_path) {
grn_name = unlist(strsplit(j,'.txt'))
data = read.table(paste0(path_use,i,'/grn_cor02/',j),header = T)
data$type = ifelse(data$value>0,'positive','negative')
if (nrow(data)>=1) {
outpath = paste0(path_use,i,'/grn_cor02_fig/',grn_name,'.tiff')
tiff(filename = outpath, width = 15000, height = 12000, units = "px", res = 1200, compression = "lzw")
print(plot_grn_irena(data))
dev.off()
}
}
for (j in grn04_path) {
grn_name = unlist(strsplit(j,'.txt'))
data = read.table(paste0(path_use,i,'/grn_cor04/',j),header = T)
data$type = ifelse(data$value>0,'positive','negative')
if (nrow(data)>=1) {
outpath = paste0(path_use,i,'/grn_cor04_fig/',grn_name,'.tiff')
tiff(filename = outpath, width = 15000, height = 12000, units = "px", res = 1200, compression = "lzw")
print(plot_grn_irena(data))
dev.off()
}
}
}
}
}
plot_main(path_use,grn=F)
library(Seurat)
library(igraph)
library(GenomicRanges)
setwd('E:\\DRCTdb\\5.Downstream_analysis')
source('identify_region_motif.R')
source('overlap_gwas.R')
source('plot.R')
### path need to define
output_path = 'E:\\DRCTdb\\ignore\\downstream_result\\sample26\\'
rna_path = 'F:\\DRCTdb\\ignore\\scRNA-seq\\Sample16\\sample16_Bone_marrow_RNA_Healthy_35k_processed.Rds'
atac_path = 'E:\\DRCTdb\\ignore\\bed\\sample26/'
ldsc_path = "E:/DRCTdb/ignore/LDSC_results/sample26/pvalues.tsv"
#### db path
snp_path = 'E:\\public\\all_snp_info_gr.Rds'
disease_path = 'E:\\DRCTdb\\ignore\\LDSC_hg38\\summary_statistics\\Josh'
source('F:\\general_code\\run_cellchat.R')
### create output folder
dir.create(paste0(output_path))
dir.create(paste0(output_path,'grn_cor04'))
dir.create(paste0(output_path,'grn_cor02'))
dir.create(paste0(output_path,'rna_snp'))
dir.create(paste0(output_path,'atac_snp'))
dir.create(paste0(output_path,'ccc'))
###load data & define cell type use
rna = readRDS(rna_path)
atac = dir(atac_path)
atac_ct = unlist(strsplit(atac,'.bed.gz'))
ct_use = intersect(rna2@active.ident,atac_ct)
ct_use = intersect(rna@active.ident,atac_ct)
atac_path = 'E:\\DRCTdb\\ignore\\bed\\sample26/hg38/'
atac = dir(atac_path)
atac_ct = unlist(strsplit(atac,'.bed.gz'))
ct_use = intersect(rna@active.ident,atac_ct)
rna = rna2
atac = dir(atac_path)
atac_ct = unlist(strsplit(atac,'.bed.gz'))
rna@active.ident = as.factor(rna$cell_type)
atac = dir(atac_path)
atac_ct = unlist(strsplit(atac,'.bed.gz'))
ct_use = intersect(rna@active.ident,atac_ct)
ct = as.character(rna$cell_type)
unique(ct)
atac_ct
ct=gsub('CD4.M','CD4_Memory',ct)
rna[['ct']]=ct
rna@active.ident = as.factor(rna$ct)
atac = dir(atac_path)
atac_ct = unlist(strsplit(atac,'.bed.gz'))
ct_use = intersect(rna@active.ident,atac_ct)
names(atac) = atac_ct
atac = atac[names(atac) %in% ct_use]
atac_list = list()
for (i in 1:length(atac)) {
bed=read.delim(paste0(atac_path,atac[i]),header = F)
peak = paste0(bed[,1],':',bed[,2],'-',bed[,3])
atac_list[[names(atac)[i]]] = peak
}
ldsc_result <- read.delim(ldsc_path)
ct_use = intersect(colnames(ldsc_result),ct_use)
snp_all = readRDS(snp_path)
ldsc_result$X = gsub(' ','_',ldsc_result$X)
###get all disease
disease_all = dir(disease_path)
disease_all_name = as.data.frame(t(as.data.frame(strsplit(disease_all,'\\.'))))
names(disease_all) = disease_all_name[,4]
### main calculation part
grn_list04 = list()
grn_list02 = list()
snp_list = list()
for (i in 1:length(ct_use)) {
### define significant disease
disease_use = ldsc_result[,1][ldsc_result[,ct_use[i]]<0.05]
disease_use = unique(disease_use)
disease_use = intersect(disease_use,names(disease_all))
for (j in disease_use) {
rna_use = subset(rna,ct==ct_use[i])
list1 = gwas_related_features(rna_use,atac_list[[i]],
disease_name=j,
snp_all = snp_all,zscore_thr = 1)
grn04 = ct_grn_atac(list1[[2]][,1:3],
unique(list1[[1]]$symbol),
rna_use,cor_thr=0.4)
grn02 = ct_grn_atac(list1[[2]][,1:3],
unique(list1[[1]]$symbol),
rna_use,cor_thr=0.2)
grn_name = paste0(ct_use[i],'_',j)
grn_list04[[grn_name]] = grn04
grn_list02[[grn_name]] = grn02
snp_list[[grn_name]] = list1
}
}
### ldsc summary
ldsc_result = ldsc_result[!duplicated(ldsc_result[,1]),]
rownames(ldsc_result) = ldsc_result[,1]
ldsc_result = ldsc_result[,ct_use]
sig_ct_list = list()
sig_ct_vector = c()
for (i in 1:nrow(ldsc_result)) {
sig_ct = colnames(ldsc_result)[ldsc_result[i,]<0.05]
if (length(sig_ct)>0) {
sig_ct_list[[rownames(ldsc_result)[i]]] = sig_ct
sig_ct_merge = paste0(sig_ct,collapse = ';')
sig_ct_vector = c(sig_ct_vector,sig_ct_merge)
}
}
sig_ct_df = data.frame(names(sig_ct_list),sig_ct_vector)
colnames(sig_ct_df) = c('disease','related_cell_type')
write.table(sig_ct_df,paste0(output_path,'disease_related_celltypes.txt'),
quote = F,sep = '\t',row.names = F)
### disease related ccc
source('F:\\general_code\\run_cellchat.R')
ccc_plot_list = list()
ccc_list = list()
for (i in 1:length(sig_ct_list)) {
disease_name_use = names(sig_ct_list)[i]
related_ct = sig_ct_list[[i]]
if (length(related_ct)>1) {
rna_use = subset(rna,ct %in% related_ct)
ccc = run_cellchat(rna_use,rna_use@meta.data,group = 'ct',species = 'hs')
groupSize <- as.numeric(table(ccc@idents))
par(mfrow=c(1,1))
p1 = netVisual_circle(ccc@net$weight, vertex.weight = groupSize,
weight.scale = T, label.edge= F,
title.name = "",vertex.label.cex = 0.7)
print(disease_name_use)
### disease related ccc
ccc_plot_list[[i]] = p1
ccc_list[[i]] = ccc
}
}
### output ccc
names(ccc_plot_list) = names(sig_ct_list)
names(ccc_list) = names(sig_ct_list)
for (i in 1:length(ccc_plot_list)) {
name_use = names(ccc_plot_list)[i]
filenames = paste0(output_path,'ccc/',name_use,'.tiff')
filenames2 = paste0(output_path,'ccc/',name_use,'.svg')
if (!is.null(ccc_plot_list[[i]])) {
tiff(filename = filenames, width = 10000, height = 6000, units = "px", res = 1200, compression = "lzw")
print(ccc_plot_list[[i]])
dev.off()
svg(filename = filenames2, width = 4, height = 4)
print(ccc_plot_list[[i]])
dev.off()
}
}
saveRDS(ccc_list,paste0(output_path,'cellchat_ccc.rds'))
### output grn
for (i in 1:length(grn_list04)) {
name_use = names(grn_list04)[i]
out1 = grn_list04[[i]]
write.table(out1,paste0(output_path,'grn_cor04/',name_use,'.txt')
,quote = F,sep = '\t',row.names = F)
out1$type = ifelse(out1$value>0,'positive','negative')
svg(filename = filenames2, width = 4, height = 4)
print(ccc_plot_list[[i]])
dev.off()
plot_grn(out1)
}
for (i in 1:length(grn_list02)) {
name_use = names(grn_list02)[i]
out1 = grn_list02[[i]]
write.table(out1,paste0(output_path,'grn_cor02/',name_use,'.txt')
,quote = F,sep = '\t',row.names = F)
}
### output snp
for (i in 1:length(snp_list)) {
name_use = names(snp_list)[i]
list_use = snp_list[[i]]
rna_snp = list_use[[1]]
atac_snp = list_use[[2]]
write.table(rna_snp,paste0(output_path,'rna_snp/',name_use,'.txt'),
quote = F,sep = '\t',row.names = F)
write.table(atac_snp,paste0(output_path,'atac_snp/',name_use,'.txt'),
quote = F,sep = '\t',row.names = F)
}
=======
install.packages("tidyverse")
install.packages('Seurat')
library(Seurat)
install.packages("parallelly")
install.packages("Seurat")
library(Seurat)
install.packages("parallelly")
install.packages("parallelly")
library(Seurat)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("Mfuzz")
library(Mfuzz)
remove.packages("SummarizedExperiment")
install.packages("C:/Users/armstrong/Desktop/SummarizedExperiment.zip", repos = NULL, type = "win.binary")
install.packages("rtracklayer")
BiocManager::install('rtracklayer')
library(rtracklayer)
rtracklayer::import(format = 'gtf')
?import
??import
'TNGGGTTGGCCTCAGAAAGGTGGAATTCTCGGGTGCCAAGGAACTCCAGTCACTAATCGATCTCGTTTGGCGTGT' |> nchar()
'taatacgactcactatagggccttctcccggagtccta'
'taatacgactcactatagggccttctcccggagtccta' |> nchar()
library(SeuratData)
devtools::install_github('satijalab/seurat-data')
df <- AvailableData()
library(SeuratData)
df <- AvailableData()
View(df)
remotes::install_github("satijalab/seurat", "seurat5", quiet = TRUE)
remove.packages("cli")
install.packages("cli")
devtools::install_github("bnprks/BPCells")
library(BPCells)
library(Seurat)
library(SeuratObject)
library(SeuratDisk)
library(Azimuth)
?save
?saveRDS
?saveRDS.Seurat
saveRDS.Seurat
saveRDS.Seurat()
SeuratObject::saveRDS()
SeuratObject::saveRDS
options(Seurat.object.assay.version = "v5")
remotes::install_github('satijalab/azimuth', ref = 'master')
BiocManager::install("batchelor")
BiocManager::install("batchelor",force = T)
BiocManager::install("batchelor",force = T)
.libPaths()
remotes::install_github('satijalab/seurat-wrappers')
remotes::install_github('satijalab/seurat-wrappers')
remotes::install_github('satijalab/seurat-wrappers')
library(SeuratWrappers)
SeuratWrappers::RunFastMNN()
shiny::runApp('C:/Users/armstrong/Desktop/flask')
?dashboardHeader
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
?dashboardHeader
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
remotes::install_github("PMBio/MuDataSeurat")
knitr::opts_chunk$set(echo = F,dev="CairoPNG", out.width = "100%")
rbbt::bbt_write_bib("references.bib",
rbbt::bbt_detect_citations(list.files(pattern = 'Rmd')),
overwrite = TRUE)
library(knitr)
library(Seurat)
library(tidyverse)
library(glue)
source('function.R')
sample <- 'sample1'
knitr::include_graphics(glue("./{sample}/Fig/PNG/{sample}_feature_plot.png"))
knitr::include_graphics(glue("./{sample}Fig/PNG/{sample}_feature_plot_othermaker.png"))
library(chromVAR)
library(motifmatchr)
library(Matrix)
library(SummarizedExperiment)
library(BiocParallel)
set.seed(2017)
options(timeout = max(1000, getOption("timeout")))
options(BioC_mirror="https://mirrors.tuna.tsinghua.edu.cn/bioconductor")
data(example_counts, package = "chromVAR")
library(BSgenome.Hsapiens.UCSC.hg19)
example_counts <- addGCBias(example_counts, genome = BSgenome.Hsapiens.UCSC.hg19)
View(example_counts)
example_counts$depth
example_counts$Cell_Type
counts_filtered <- filterSamples(example_counts, min_depth = 1500,
min_in_peaks = 0.15)
counts_filtered <- filterPeaks(counts_filtered)
motifs <- getJasparMotifs()
BiocManager::install('JASPAR2016')
motifs <- getJasparMotifs()
View(motifs)
dev <- computeDeviations(object = counts_filtered,
annotations = motif_ix)
motif_ix <- matchMotifs(motifs, counts_filtered,
genome = BSgenome.Hsapiens.UCSC.hg19)
dev <- computeDeviations(object = counts_filtered, annotations = motif_ix)
View(dev)
dev@colData
dev@assays
dev@elementMetadata
variability <- computeVariability(dev)
View(variability)
get_name <- function(x){
R1 = paste0(x,'_S1_L001_R1_001.fastq.gz')
R2 = paste0(x,'_S1_L001_R2_001.fastq.gz')
R3 = paste0(x,'_S1_L001_R3_001.fastq.gz')
df <- tibble::tibble(R1,R2,R3)
print(df)
return(df)
}
get_name('SAMP-689')
get_name <- function(x){
R1 = paste0(x,'_S1_L001_R1_001.fastq.gz')
R2 = paste0(x,'_S1_L001_R2_001.fastq.gz')
R3 = paste0(x,'_S1_L001_R3_001.fastq.gz')
df <- tibble::tibble(R1,R2,R3)
return(df)
}
get_name('SAMP-689')
get_name <- function(x){
R1 = paste0(x,'_S1_L001_R1_001.fastq.gz')
R2 = paste0(x,'_S1_L001_R2_001.fastq.gz')
R3 = paste0(x,'_S1_L001_R3_001.fastq.gz')
df <- tibble::tibble(name = c(R1,R2,R3))
return(df)
}
get_name('SAMP-689')
get_name <- function(x){
R1 = paste0(x,'_S1_L001_R1_001.fastq.gz')
R2 = paste0(x,'_S1_L001_R2_001.fastq.gz')
R3 = paste0(x,'_S1_L001_R3_001.fastq.gz')
df <- tibble::tibble(name = c(R1,R2,R3))
print(df)
return(df)
}
get_name('SAMP-689')
get_name <- function(x){
R1 = paste0(x,'_S1_L001_R1_001.fastq.gz')
R2 = paste0(x,'_S1_L001_R2_001.fastq.gz')
R3 = paste0(x,'_S1_L001_R3_001.fastq.gz')
df <- tibble::tibble(name = c(R1,R2,R3))
return(df)
}
get_name('SAMP-689')
get_name('SAMP-1097')
get_name('SAMP-1136')
get_name('SAMP-692')
nchar('GAGTAACAGAACTGGCTGCTGGTTCTTTACAATTGCCCAGCTGCTCNGCA')
?fread
'GAAGAGCAGGCATGCA'
'GAAGAGCAGGCATGCA' |> nchar()
4^16
get_name('SAMP-1144')
get_name('SAMP-1149')
get_name('SAMP-1151')
get_name('SAMP-1607')
get_name('SAMP-1148')
get_name('SAMP-1611')
get_name('SAMP-1137')
get_name('SAMP-1610')
get_name('SAMP-1602')
get_name('SAMP-1697')
get_name('SAMP-689')
get_name('SAMP-1097')
get_name('SAMP-1136')
get_name('SAMP-692')
knitr::opts_chunk$set(echo = F,dev="CairoPNG", out.width = "100%")
rbbt::bbt_write_bib("references.bib",
rbbt::bbt_detect_citations(list.files(pattern = 'Rmd')),
overwrite = TRUE)
library(knitr)
library(glue)
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Alpha_DEGs_across_multi-sample2.png")
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Beta_DEGs_across_multi-sample2.png")
?include_graphics
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Alpha_DEGs_across_multi-sample2.png")
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Beta_DEGs_across_multi-sample2.png")
install.packages("igraph")
setwd("E:/DRCTDb/DRCTdb/5.Downstream_analysis")
library(ChIPseeker)
library(tidyverse)
library(GenomicRanges)
peak_anno <- function(reference_GRange, tssRegion = c(-2000, 500),filter = FALSE) {
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
library(org.Hs.eg.db)
annodb <- 'org.Hs.eg.db'
peakAnno <- ChIPseeker::annotatePeak(reference_GRange,
tssRegion = tssRegion,
TxDb = txdb, annoDb = annodb,
verbose = F
)
region <- peakAnno@anno@elementMetadata$annotation
gene <- peakAnno@anno@elementMetadata$ENSEMBL
symbol <- peakAnno@anno@elementMetadata$SYMBOL
start1 <- peakAnno@anno@ranges@start
dis <- peakAnno@anno@elementMetadata$distanceToTSS
exon1 <- grep('exon',region)
Intron1 <- grep('Intron',region)
Intergenic1 <- grep('Intergenic',region)
Downstream1 <- grep('Downstream',region)
Promoter1 <- grep('Promoter',region)
UTR3 <- grep("3' UTR",region)
UTR5 <- grep("5' UTR",region)
region2 <- rep(NA,length(region))
region2[exon1]='Exon'
region2[Intron1]='Intron'
region2[Downstream1]='Downstream'
region2[Promoter1]='Promoter'
region2[UTR3]="3' UTR"
region2[UTR5]="5' UTR"
region2[Intergenic1]='Intergenic'
table(region2)
peak_region1 <- paste(as.character(peakAnno@anno@seqnames),
as.character(peakAnno@anno@ranges),sep = ':')
peak_gr=reference_GRange
peak_gr$gene = gene
peak_gr$symbol = symbol
peak_gr$region = region2
peak_gr$distanceToTSS = dis
### filter peaks based on annotation
if (filter) {
peak_gr = peak_gr[peak_gr$region=='Promoter']
}
return(peak_gr)
}
snp_file <- list.files('../../data/downstream_result/',pattern = '.txt',full.names = T,recursive = T) %>% str_subset('snp')
test <-
data.table::fread(snp_file[1],header = F)
View(test)
test <-
data.table::fread(snp_file[1])
test <-
data.table::fread(snp_file[1]) |>
dplyr::select(c(1:3,11,7))
colnames(test)[7] <- 'SNP_location'
View(test)
test <- test |> dplyr::select(c(1:3, 11, 7)) |> makeGRangesFromDataFrame(keep.extra.columns = T) |>
peak_anno() |>
as.data.frame()
df <- df |> dplyr::select(c(1:3, 11, 7)) |> makeGRangesFromDataFrame(keep.extra.columns = T) |>
peak_anno()
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% makeGRangesFromDataFrame(keep.extra.columns = T) |>
peak_anno() %>%
as.data.frame()
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% makeGRangesFromDataFrame(keep.extra.columns = T) |>
peak_anno()
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% makeGRangesFromDataFrame(keep.extra.columns = T)
test
peak_anno(test)
colnames(test)
test <-
data.table::fread(snp_file[1])
colnames(test)
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% mutute(seqnames = paste0('chr',seqnames)) |>
makeGRangesFromDataFrame(keep.extra.columns = T)  |>
peak_anno(test) |>
as.data.frame()
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) |>
makeGRangesFromDataFrame(keep.extra.columns = T)  |>
peak_anno(test) |>
as.data.frame()
colnames(test)[7] <- 'SNP_location'
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) |>
makeGRangesFromDataFrame(keep.extra.columns = T)  |>
peak_anno(test) |>
as.data.frame()
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) |>
makeGRangesFromDataFrame(keep.extra.columns = T)
test <-
data.table::fread(file)
test <-
data.table::fread(snp_file[1])
colnames(test)[7] <- 'SNP_location'
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) |>
makeGRangesFromDataFrame(keep.extra.columns = T) |>
peak_anno(test)
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) |>
makeGRangesFromDataFrame(keep.extra.columns = T)
test
test@seqnames |> unique()
peak_anno(test)
test <-
data.table::fread(snp_file[1])
colnames(test)[7] <- 'SNP_location'
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) %>%
makeGRangesFromDataFrame(keep.extra.columns = T) %>%
peak_anno(test) %>%
as.data.frame()
test <-
data.table::fread(snp_file[1])
colnames(test)[7] <- 'SNP_location'
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) %>%
makeGRangesFromDataFrame(keep.extra.columns = T) %>%
peak_anno(test)
test <-
data.table::fread(snp_file[1])
colnames(test)[7] <- 'SNP_location'
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) %>%
makeGRangesFromDataFrame(keep.extra.columns = T)
test <-  peak_anno(test)
test <-
data.table::fread(snp_file[1])
colnames(test)[7] <- 'SNP_location'
test <- test %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) %>%
makeGRangesFromDataFrame(keep.extra.columns = T)
test <-  peak_anno(test) %>% as.data.frame()
snp_file
map(snp_file,function(file){
df <-
data.table::fread(file)
colnames(df)[7] <- 'SNP_location'
gr <- df %>% dplyr::select(c(1:3, 11, 7)) %>% dplyr::mutate(seqnames = paste0('chr',seqnames)) %>%
makeGRangesFromDataFrame(keep.extra.columns = T)
df1 <-  peak_anno(gr) %>% as.data.frame()
data.table::fwrite(df1,file = file,sep = '\t')
},.progress = T)
>>>>>>> 5d7b7a3f2a0d12b995bd405efd81107643680140
