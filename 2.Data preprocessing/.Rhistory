install.packages("tidyverse")
install.packages('Seurat')
library(Seurat)
install.packages("parallelly")
install.packages("Seurat")
library(Seurat)
install.packages("parallelly")
install.packages("parallelly")
library(Seurat)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("Mfuzz")
library(Mfuzz)
remove.packages("SummarizedExperiment")
install.packages("C:/Users/armstrong/Desktop/SummarizedExperiment.zip", repos = NULL, type = "win.binary")
install.packages("rtracklayer")
BiocManager::install('rtracklayer')
library(rtracklayer)
rtracklayer::import(format = 'gtf')
?import
??import
'TNGGGTTGGCCTCAGAAAGGTGGAATTCTCGGGTGCCAAGGAACTCCAGTCACTAATCGATCTCGTTTGGCGTGT' |> nchar()
'taatacgactcactatagggccttctcccggagtccta'
'taatacgactcactatagggccttctcccggagtccta' |> nchar()
library(SeuratData)
devtools::install_github('satijalab/seurat-data')
df <- AvailableData()
library(SeuratData)
df <- AvailableData()
View(df)
remotes::install_github("satijalab/seurat", "seurat5", quiet = TRUE)
remove.packages("cli")
install.packages("cli")
devtools::install_github("bnprks/BPCells")
library(BPCells)
library(Seurat)
library(SeuratObject)
library(SeuratDisk)
library(Azimuth)
?save
?saveRDS
?saveRDS.Seurat
saveRDS.Seurat
saveRDS.Seurat()
SeuratObject::saveRDS()
SeuratObject::saveRDS
options(Seurat.object.assay.version = "v5")
remotes::install_github('satijalab/azimuth', ref = 'master')
BiocManager::install("batchelor")
BiocManager::install("batchelor",force = T)
BiocManager::install("batchelor",force = T)
.libPaths()
remotes::install_github('satijalab/seurat-wrappers')
remotes::install_github('satijalab/seurat-wrappers')
remotes::install_github('satijalab/seurat-wrappers')
library(SeuratWrappers)
SeuratWrappers::RunFastMNN()
shiny::runApp('C:/Users/armstrong/Desktop/flask')
?dashboardHeader
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
?dashboardHeader
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
runApp('C:/Users/armstrong/Desktop/flask')
library(Seurat)
library(Signac)
setwd("E:/Db/DRCTdb/1.Data_format_normalization")
#scATAC-seq
merged_matrix <- ReadMtx('../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.mtx',
cells = '../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.barcodes',
features = '../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.regions',
feature.column = 1)
?ReadMtx
#scATAC-seq
merged_matrix_ATAC <- ReadMtx('../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.mtx',
features = '../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.barcodes',
cells = '../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.regions',
feature.column = 1)
merged_matrix_ATAC
merged_matrix_ATAC <- t(merged_matrix_ATAC)
merged_matrix_ATAC <- Matrix::t(merged_matrix_ATAC)
merged_matrix_RNA <- ReadMtx('../../data/scATAC-seq/Sample23/multiome/beta_RNA.mtx',
features = '../../data/scATAC-seq/Sample23/multiome/beta_RNA.barcodes',
cells = '../../data/scATAC-seq/Sample23/multiome/beta_RNA.genes',
feature.column = 1)
merged_matrix_RNA <- Matrix::t(merged_matrix_RNA)
label <- read.delim("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz", row.names=1)
label <- data.table::fread("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz", row.names=1)
label <- data.table::fread("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz")
View(label)
View(label)
rownames(label) <- label$X
label <- label[,c(-1,-2)]
label <- data.table::fread("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz") %>% as.data.frame()
rownames(label) <- label$X
label <- data.table::fread("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz") |> as.data.frame()
rownames(label) <- label$X
label <- label[,c(-1,-2)]
obj <- CreateSeuratObject(merged_matrix,meta.data = metadata)
obj <- CreateSeuratObject(merged_matrix_RNA,meta.data = metadata)
obj <- CreateSeuratObject(merged_matrix_RNA,meta.data = label)
saveRDS(merged_matrix_RNA,'../../data/scRNA-seq/Sample23/sample23_scRNAseq.Rds')
sample1 <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = label
)
chrom_assay <- CreateChromatinAssay(
counts = merged_matrix_ATAC,
sep = c(":", "-"),
genome = 'hg19',
min.cells = 10,
min.features = 200
)
sample1 <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = label
)
sample1$cell_type <- sample1$subtype
saveRDS(sample1,file = '../../data/scATAC-seq/sample1/Rds/sample1_scATAC-seq_80k_processed.Rds')
sample23 <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = label
)
saveRDS(sample23,file = '../../data/scATAC-seq/sample23/sample23_scATAC-seq.Rds')
### Transfer data to seurat object
library(Seurat)
library(Signac)
merged_matrix <- ReadMtx('../../data/scATAC-seq/sample1/GSE165837_CARE_ATAC_merged_matrix.mtx.gz',
cells = '../../data/scATAC-seq/sample1/GSE165837_CARE_ATAC_merged_barcodes.txt.gz',
features = '../../data/scATAC-seq/sample1/GSE165837_CARE_ATAC_merged_features.txt.gz',
feature.column = 1)
label <- read.delim("../../data/scATAC-seq/sample1/GSE165837_CARE_ATAC_merged_umap_cluster_labels.tsv.gz", row.names=1)
chrom_assay <- CreateChromatinAssay(
counts = merged_matrix,
sep = c(":", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample1 <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = label
)
sample1$cell_type <- sample1$Cluster
saveRDS(sample1,file = '../../data/scATAC-seq/sample1/Rds/sample1_scATAC-seq_80k_processed.Rds')
### Transfer data to seurat object
library(Seurat)
library(tidyverse)
merged_matrix <- ReadMtx(mtx = '../../data/scRNA-seq/sample1/GSE165838_CARE_RNA_counts.mtx.gz',
cells = '../../data/scRNA-seq/sample1/GSE165838_CARE_RNA_barcodes.txt.gz',cell.column = 2, skip.cell = 1,
features = '../../data/scRNA-seq/sample1/GSE165838_CARE_RNA_features.tsv.gz',feature.column = 2,skip.feature = 1)
metadata <- read.delim("../../data/scRNA-seq/sample1/GSE165838_CARE_RNA_metadata.txt.gz", row.names=1)
obj <- CreateSeuratObject(merged_matrix,meta.data = metadata)
saveRDS(obj,file = '../../data/scRNA-seq/sample1/sample1_heart_scRNA_35k_processed.Rds')
sample23_ATAC <- readRDS('../../data/scATAC-seq/Sample23/sample23_scATAC-seq.Rds')
sparse_mtx <- sample23_ATAC@assays$peaks@counts
sparse_mtx <- sparse_mtx[str_starts(rownames(sparse_mtx),'chr'),]
setwd("E:/Db/DRCTdb/2.Data preprocessing")
source('preprocess_functions.R')
sample23_ATAC <- readRDS('../../data/scATAC-seq/Sample23/sample23_scATAC-seq.Rds')
sparse_mtx <- sample23_ATAC@assays$peaks@counts
sparse_mtx <- sparse_mtx[str_starts(rownames(sparse_mtx),'chr'),]
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample1_ATAC$cell_type)
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
setwd("E:/Db/DRCTdb/1.Data_format_normalization")
### Transfer data to seurat object
library(Seurat)
library(Signac)
label <- data.table::fread("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz") |> as.data.frame()
rownames(label) <- label$X
label <- label[,c(-1,-2)]
gc()
merged_matrix_ATAC <- ReadMtx('../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.mtx',
features = '../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.barcodes',
cells = '../../data/scATAC-seq/Sample23/multiome/beta_ATAC_500bp.regions',
feature.column = 1)
merged_matrix_ATAC <- Matrix::t(merged_matrix_ATAC)
chrom_assay <- CreateChromatinAssay(
counts = merged_matrix_ATAC,
sep = c(":", "-"),
genome = 'hg19',
min.cells = 10,
min.features = 200
)
sample23 <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = label
)
library(Signac)
label <- data.table::fread("../../data/scATAC-seq/Sample23/multiome/GSE200044_multiome_beta_annotation.csv.gz") |> as.data.frame()
rownames(label) <- label$X
label <- label[,c(-1,-2)]
sample23 <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = label
)
sample23$subtype
sample23$cell_type <- sample23$subtype
saveRDS(sample23,file = '../../data/scATAC-seq/sample23/sample23_scATAC-seq.Rds')
setwd("E:/Db/DRCTdb/2.Data preprocessing")
library(Signac)
library(Seurat)
library(tidyverse)
library(Matrix)
library(glue)
source('preprocess_functions.R')
sample23_ATAC <- readRDS('../../data/scATAC-seq/Sample23/sample23_scATAC-seq.Rds')
sparse_mtx <- sample23_ATAC@assays$peaks@counts
sparse_mtx <- sparse_mtx[str_starts(rownames(sparse_mtx),'chr'),]
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
cell_gr <- separate(as.data.frame(rownames(pseudobulk)),col = everything(),sep = '-',into = c('seqnames','start','end'))
cell_gr_list <- map(colnames(pseudobulk),get_cell_gr,seurat_Obj = sample1_ATAC)
cell_gr <- separate(as.data.frame(rownames(pseudobulk)),col = everything(),sep = '-',into = c('seqnames','start','end'))
cell_gr_list <- map(colnames(pseudobulk),get_cell_gr,seurat_Obj = sample23_ATAC)
cell_gr <- separate(as.data.frame(rownames(pseudobulk)),col = everything(),sep = '-',into = c('seqnames','start','end'))
colnames(pseudobulk)
cell_gr_list <- map(colnames(pseudobulk),get_cell_gr,seurat_Obj = sample23_ATAC)
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
sparse_mtx <- sample23_ATAC@assays$peaks@counts
rownames(sparse_mtx)
rownames(sparse_mtx)
str_extract(rownames(sparse_mtx),'\\d+')
str_extract(rownames(sparse_mtx),'\\d+') |> table()
str_extract(rownames(sparse_mtx),'\\d+')
str_extract(rownames(sparse_mtx),'\\d+') |>ã€€table()
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
sparse_mtx <- sample23_ATAC@assays$peaks@counts
rownames(sparse_mtx) <- paste0('Chr',rownames(sparse_mtx))
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
View(pseudobulk)
sparse_mtx <- sample23_ATAC@assays$peaks@counts
rownames(sparse_mtx) <- paste0('chr',rownames(sparse_mtx))
pseudobulk <- generate_pseudobulk(sparse_mtx,group_by = sample23_ATAC$cell_type)
cell_gr <- separate(as.data.frame(rownames(pseudobulk)),col = everything(),sep = '-',into = c('seqnames','start','end'))
cell_gr_list <- map(colnames(pseudobulk),get_cell_gr,seurat_Obj = sample23_ATAC)
names(cell_gr_list) <- colnames(pseudobulk)
sample <- 'sample23'
for (i in 1:length(cell_gr_list)) {
if (!dir.exists(glue('../../data/bed/{sample}'))) {
dir.create(glue('../../data/bed/{sample}'))
}
filenames <- paste0(glue('../../data/bed/{sample}/'),names(cell_gr_list)[i],'.bed.gz')
rtracklayer::export.bed(object = cell_gr_list[[i]],con = filenames)
cat(names(cell_gr_list)[i],'\n')
}
