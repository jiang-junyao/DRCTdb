return(df)
}
get_name('SAMP-689')
get_name('SAMP-1097')
get_name('SAMP-1136')
get_name('SAMP-692')
nchar('GAGTAACAGAACTGGCTGCTGGTTCTTTACAATTGCCCAGCTGCTCNGCA')
?fread
'GAAGAGCAGGCATGCA'
'GAAGAGCAGGCATGCA' |> nchar()
4^16
get_name('SAMP-1144')
get_name('SAMP-1149')
get_name('SAMP-1151')
get_name('SAMP-1607')
get_name('SAMP-1148')
get_name('SAMP-1611')
get_name('SAMP-1137')
get_name('SAMP-1610')
get_name('SAMP-1602')
get_name('SAMP-1697')
get_name('SAMP-689')
get_name('SAMP-1097')
get_name('SAMP-1136')
get_name('SAMP-692')
knitr::opts_chunk$set(echo = F,dev="CairoPNG", out.width = "100%")
rbbt::bbt_write_bib("references.bib",
rbbt::bbt_detect_citations(list.files(pattern = 'Rmd')),
overwrite = TRUE)
library(knitr)
library(glue)
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Alpha_DEGs_across_multi-sample2.png")
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Beta_DEGs_across_multi-sample2.png")
?include_graphics
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Alpha_DEGs_across_multi-sample2.png")
knitr::include_graphics("../../Islet_public_dataset/Fig/PNG/Beta_DEGs_across_multi-sample2.png")
install.packages("igraph")
library(sceasy)
library(reticulate)
loompy <- reticulate::import('loompy')
library(sceasy)
library(reticulate)
use_condaenv('scanpy')
library(sceasy)
library(reticulate)
use_condaenv('scanpy')
q()
library(sceasy)
library(reticulate)
use_condaenv('scanpy')
library(sceasy)
library(reticulate)
use_condaenv('scanpy')
loompy <- reticulate::import('loompy')
sample1_ATAC <- readRDS('../../data/scATAC-seq/sample1/Rds/sample1_scATAC-seq_80k_processed.Rds')
setwd("E:/DRCTDb/DRCTdb/1.Data_format_normalization")
sample1_ATAC <- readRDS('../../data/scATAC-seq/sample1/Rds/sample1_scATAC-seq_80k_processed.Rds')
sceasy::convertFormat(sample1_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample1/Rds/sample1_scATAC-seq_80k_processed.h5ad')
setwd("E:/DRCTDb/DRCTdb/2.Data preprocessing")
source('preprocess_functions.R')
sample4_ATAC <- readRDS('../../data/scATAC-seq/Sample4/Sample4_peak_matrix.Rds')
sample4_ATAC$Celltype
sample4_ATAC$Celltype |> table()
sparse_mtx <- sample4_ATAC@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample4_ATAC@rowRanges)[[1]],as.data.frame(sample4_ATAC@rowRanges)[[2]],as.data.frame(sample4_ATAC@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
library(tidyverse)
sparse_mtx <- sample4_ATAC@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample4_ATAC@rowRanges)[[1]],as.data.frame(sample4_ATAC@rowRanges)[[2]],as.data.frame(sample4_ATAC@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
sample4_ATAC$cell_type <- sample4_ATAC$Celltype
sparse_mtx
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
colnames(sparse_mtx)
rownames(sample4_ATAC@metadata)
sample4_ATAC@metadata
rownames(sample4_ATAC@metadata)
rownames(sample4_ATAC@colData)
identical(colnames(sparse_mtx),rownames(sample4_ATAC@colData))
sample4_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = sample4_ATAC@colData
)
sample4_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = sample4_ATAC@colData
)
sample4_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = sample4_ATAC@colData
)
library(Seurat)
sample4_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = sample4_ATAC@colData
)
sample4_mtx <- readRDS('../../data/scATAC-seq/Sample4/Sample4_peak_matrix.Rds')
sparse_mtx <- sample4_ATAC@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample4_ATAC@rowRanges)[[1]],as.data.frame(sample4_ATAC@rowRanges)[[2]],as.data.frame(sample4_ATAC@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
sample4_mtx$cell_type <- sample4_mtx$Celltype
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample4_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks"
)
identical(colnames(sparse_mtx),rownames(sample4_mtx@colData))
sample4_mtx@colData
sample4_ATAC <- AddMetaData(sample4_ATAC,metadata = sample4_mtx@colData)
sample4_ATAC <- AddMetaData(sample4_ATAC,metadata = as.data.frame(sample4_mtx@colData))
sample4_ATAC$cell_type |> table()
sample4_ATAC
saveRDS(sample4_ATAC,file = '../../data/scATAC-seq/Sample4/sample4_scATAC-seq_30k_processed.Rds')
sceasy::convertFormat(sample4_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample4/Rds/sample1_scATAC-seq_30k_processed.h5ad')
sceasy::convertFormat(sample4_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample4/Rds/sample4_scATAC-seq_30k_processed.h5ad')
sceasy::convertFormat(sample4_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample4/sample4_scATAC-seq_30k_processed.h5ad')
sample4_mtx <- readRDS('../../data/scATAC-seq/Sample4/Sample4_peak_matrix.Rds')
sparse_mtx <- sample4_mtx@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample4_mtx@rowRanges)[[1]],as.data.frame(sample4_mtx@rowRanges)[[2]],as.data.frame(sample4_mtx@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
sample4_mtx$cell_type <- sample4_mtx$Celltype
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample4_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks"
)
identical(colnames(sparse_mtx),rownames(sample4_mtx@colData))
sample4_ATAC <- AddMetaData(sample4_ATAC,metadata = as.data.frame(sample4_mtx@colData))
saveRDS(sample4_ATAC,file = '../../data/scATAC-seq/Sample4/sample4_scATAC-seq_30k_processed.Rds')
sceasy::convertFormat(sample4_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample4/sample4_scATAC-seq_30k_processed.h5ad')
sample7_mtx<- readRDS('../../data/scATAC-seq/Sample7/Sample7_peak_matrix.Rds')
sparse_mtx <- sample7_mtx@assays@data$PeakMatrix
sample7_mtx$cell_type <- sample7_mtx$Sample
rownames(sparse_mtx) <- paste(as.data.frame(sample7_mtx@rowRanges)[[1]],as.data.frame(sample7_mtx@rowRanges)[[2]],as.data.frame(sample7_mtx@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks"
)
identical(colnames(sparse_mtx),rownames(sample7_mtx@colData))
sample7_ATAC
saveRDS(sample7_ATAC,file = '../../data/scATAC-seq/Sample4/sample7_scATAC-seq_50k_processed.Rds')
saveRDS(sample7_ATAC,file = '../../data/scATAC-seq/Sample4/sample7_scATAC-seq_50k_processed.Rds')
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample4/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC
sample4_ATAC
sample1_ATAC
saveRDS(sample7_ATAC,file = '../../data/scATAC-seq/Sample7/sample7_scATAC-seq_50k_processed.Rds')
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC
identical(colnames(sparse_mtx),rownames(sample7_mtx@colData))
identical(colnames(sparse_mtx),rownames(sample7_mtx@colData))
sample7_ATAC <- AddMetaData(sample7_ATAC,metadata = as.data.frame(sample7_mtx@colData))
sample7_ATAC$cell_type |> table()
sample7_ATAC$cell_type |> table() |> length()
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC@meta.data
sample7_ATAC@meta.data |> colnames()
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC@meta.data <- sample7_ATAC@meta.data[,c("cell_type")]
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks"
)
identical(colnames(sparse_mtx),rownames(sample7_mtx@colData))
sample7_ATAC$cell_type <- sample7_mtx$cell_type
sample7_ATAC$cell_type
identical(colnames(sparse_mtx),rownames(sample7_mtx@colData))
sample7_ATAC$cell_type
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks"
)
identical(colnames(sample7_ATAC),rownames(sample7_mtx@colData))
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample7_mtx$cell_type)
)
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample7_mtx@colData)
)
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC$cell_type
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC$orig.ident
sample7_ATAC$Sample
#sample7----
sample7_mtx<- readRDS('../../data/scATAC-seq/Sample7/Sample7_peak_matrix.Rds')
sparse_mtx <- sample7_mtx@assays@data$PeakMatrix
sample7_mtx$cell_type <- sample7_mtx$Sample
rownames(sparse_mtx) <- paste(as.data.frame(sample7_mtx@rowRanges)[[1]],as.data.frame(sample7_mtx@rowRanges)[[2]],as.data.frame(sample7_mtx@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks"
)
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
sample7_ATAC
sparse_mtx
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
library(Seurat)
library(sceasy)
library(tidyverse)
library(reticulate)
use_condaenv('scanpy')
loompy <- reticulate::import('loompy')
sample7_mtx<- readRDS('../../data/scATAC-seq/Sample7/Sample7_peak_matrix.Rds')
sparse_mtx <- sample7_mtx@assays@data$PeakMatrix
sample7_mtx$cell_type <- sample7_mtx$Sample
rownames(sparse_mtx) <- paste(as.data.frame(sample7_mtx@rowRanges)[[1]],as.data.frame(sample7_mtx@rowRanges)[[2]],as.data.frame(sample7_mtx@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
source('../2.Data preprocessing/preprocess_functions.R')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
library(signac)
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample7_mtx@colData)
)
library(Seurat)
library(signac)
library(sceasy)
install.packages("signac")
install.packages("Signac")
library(signac)
library(Signac)
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample7_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample7_mtx@colData)
)
sceasy::convertFormat(sample7_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample7/sample7_scATAC-seq_50k_processed.h5ad')
saveRDS(sample7_ATAC,file = '../../data/scATAC-seq/Sample7/sample7_scATAC-seq_50k_processed.Rds')
sample8_ATAC <- readRDS('../../data/scATAC-seq/Sample8/sample8_peak_matrix.Rds')
sparse_mtx <- sample8_ATAC@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample8_ATAC@rowRanges)[[1]],as.data.frame(sample8_ATAC@rowRanges)[[2]],as.data.frame(sample8_ATAC@rowRanges)[[3]],sep = '-')
metadata <- read.csv('../../data/scATAC-seq/Sample8/atac_barcodes.csv')
get_celltype <- function(x){
res <- metadata[str_which(metadata$barcode,x),]$celltype
if (length(res) > 1) {
res <- unique(res)
if (length(res) > 1) {
res <- 'Unknown'
}
}else if(length(res) ==0 ){
res <- 'Unknown'
}
return(res)
}
cell_type_list <- map(str_extract(colnames(sparse_mtx),'(?<=#)[A-Z]+'),get_celltype)
sample8_ATAC$cell_type <- cell_type
cell_type <- unlist(cell_type_list)
cell_type_list <- map(str_extract(colnames(sparse_mtx),'(?<=#)[A-Z]+'),get_celltype)
cell_type <- unlist(cell_type_list)
sample8_ATAC$cell_type <- cell_type
table()
table(sample8_ATAC$cell_type)
as.data.frame(sample8_ATAC@colData)
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample8_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample8_ATAC@colData)
)
sample8_ATAC
sceasy::convertFormat(sample8_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample8/sample8_scATAC-seq_100k_processed.h5ad')
saveRDS(sample8_ATAC,file = '../../data/scATAC-seq/Sample8/sample8_scATAC-seq_100k_processed.Rds')
sample10_ATAC <- readRDS('../../data/scATAC-seq/Sample10/sample10_peak_matrix.Rds')
sample10_ATAC$cell_type <- str_replace(sample10_ATAC$cell_type,'\\+','_high')
sample10_ATAC$cell_type <- str_replace_all(sample10_ATAC$cell_type,'/','_')
sample10_ATAC$cell_type <- str_replace_all(sample10_ATAC$cell_type,' ','_')
sample10_ATAC$cell_type <- str_replace_all(sample10_ATAC$cell_type,'[.]','')
sparse_mtx <- sample10_ATAC@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample10_ATAC@rowRanges)[[1]],as.data.frame(sample10_ATAC@rowRanges)[[2]],as.data.frame(sample10_ATAC@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample10_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample10_ATAC@colData)
)
sample10_ATAC$cell_type <- str_replace(sample10_ATAC$cell_type,'\\+','_high')
sample10_ATAC$cell_type <- str_replace_all(sample10_ATAC$cell_type,'/','_')
sample10_ATAC$cell_type <- str_replace_all(sample10_ATAC$cell_type,' ','_')
sample10_ATAC$cell_type <- str_replace_all(sample10_ATAC$cell_type,'[.]','')
sample10_ATAC
sceasy::convertFormat(sample10_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample10/sample10_scATAC-seq_950k_processed.h5ad')
saveRDS(sample10_ATAC,file = '../../data/scATAC-seq/Sample10/sample10_scATAC-seq_950k_processed.Rds')
ls()
str_which(ls(),'sample')
ls()[str_which(ls(),'sample')]
rm(list = ls())
source('../2.Data preprocessing/preprocess_functions.R')
sample11_ATAC <- readRDS('../../data/scATAC-seq/Sample11/Sample11_peak_matrix.Rds')
sample11_ATAC@colData$barcode <- rownames(sample11_ATAC@colData)
sample11_ATAC@colData$barcode <- str_extract(sample11_ATAC@colData$barcode,'(?<=#).*')
coldata <- as.data.frame(sample11_ATAC@colData)
coldata$raw_barcode <- rownames(coldata)
sparse_mtx <- sample11_ATAC@assays@data$PeakMatrix
rownames(sparse_mtx) <- paste(as.data.frame(sample11_ATAC@rowRanges)[[1]],as.data.frame(sample11_ATAC@rowRanges)[[2]],as.data.frame(sample11_ATAC@rowRanges)[[3]],sep = '-')
sparse_mtx <- sparse_mtx[which(map_vec(rownames(sparse_mtx),subset_peaks)),]
metadata <- readRDS('../../data/scATAC-seq/Sample11/meta.rds')
metadata$barcode <- rownames(metadata)
metadata$barcode <- str_replace(metadata$barcode,'h_Donor','hr_Donor')
coldata <- coldata %>% left_join(metadata,by = 'barcode')
coldata$cell_type <- coldata$pairedLabel
coldata2 <- coldata[which(!is.na(coldata$cell_type)),]
sparse_mtx <- sparse_mtx[,which(!is.na(coldata$cell_type))]
identical(colnames(sparse_mtx),coldata2$raw_barcode)
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample11_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(coldata2)
)
sample11_ATAC
saveRDS(sample11_ATAC,file = '../../data/scATAC-seq/Sample11/sample11_scATAC-seq_17k_processed.Rds')
sceasy::convertFormat(sample11_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample10/sample11_scATAC-seq_17k_processed.h5ad')
sceasy::convertFormat(sample11_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample11/sample11_scATAC-seq_17k_processed.h5ad')
sample12_ATAC <- readRDS('../../data/scATAC-seq/Sample12/Sample12_ATAC-seq.Rds')
sparse_mtx <- sample12_ATAC@assays$peaks@counts
sparse_mtx <- sparse_mtx[str_starts(rownames(sparse_mtx),'chr'),]
sample12_ATAC$cell_type <- str_replace_all(sample12_ATAC$cell_type,' ','_')
sample12_ATAC$cell_type <- str_replace_all(sample12_ATAC$cell_type,'/','')
sample12_ATAC
sceasy::convertFormat(sample12_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample12/sample11_scATAC-seq_104k_processed.h5ad')
sceasy::convertFormat(sample12_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample12/sample12_scATAC-seq_104k_processed.h5ad')
gc()
#sample14----
sample14_ATAC <- readRDS('../../data/scATAC-seq/sample14/sample14.Rds')
#sample14----
sample14_ATAC <- readRDS('../../data/scATAC-seq/sample14/sample14_processed_95k_scATAC.Rds')
sample14_ATAC
sceasy::convertFormat(sample14_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample14/sample14_scATAC-seq_104k_processed.h5ad')
sceasy::convertFormat(sample14_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample14/sample14_scATAC-seq_95k_processed.h5ad')
ls()[str_which(ls(),'sample')]
rm(list = ls()[str_which(ls(),'sample')])
gc()
sample13_ATAC@meta.data
sample13_ATAC <- readRDS('../../data/scATAC-seq/Sample13/sample13_Bone_marrow_ATAC_4k_processed.Rds.rds')
metadata <- sample13_ATAC@meta.data
View(metadata)
sample13_ATAC$marker
sample13_ATAC$marker | >table()
sample13_ATAC$marker |> table()
sample13_ATAC$predicted.id
sample13_ATAC$predicted.id |> table()
#sample13----
sample13_ATAC <- readRDS('../../data/scATAC-seq/Sample13/sample13_Bone_marrow_ATAC_4k_processed.Rds.rds')
sample13_ATAC$cell_type <- sample13_ATAC$predicted.id
sample13_ATAC
sceasy::convertFormat(sample13_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample13/sample13_scATAC-seq_4k_processed.h5ad')
saveRDS(sample13_ATAC,'../../data/scATAC-seq/Sample13/sample13_Bone_marrow_ATAC_4k_processed.Rds')
#sample13----
sample13_RNA <- readRDS('../../data/scRNA-seq/Sample13/sample13_Bone_marrow_8k.Rds')
sample13_RNA$cell_type |> table()
test <- readRDS('../../data/scRNA-seq/Sample11/Sample11_processed_PBMC_healthy_173k.Rds')
sample13_RNA$cell_type
test$cell_type |> table()
test$cell_type
test
#sample15----
sample16_ATAC <- readRDS('../../data/scATAC-seq/sample16/sample16_Bone_marrow_ATAC_Healthy_35k_processed.Rds')
sceasy::convertFormat(sample16_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample16/sample16_scATAC-seq_35k_processed.h5ad')
#sample23----
sample23_ATAC <- readRDS('../../data/scATAC-seq/sample23/islet_multiome_seurat_singac.Rds')
sample23_ATAC
DefaultAssay(ATAC)
DefaultAssay(sample23_ATAC)
DefaultAssay(sample23_ATAC) <- 'ATAC'
sceasy::convertFormat(sample16_ATAC, from="seurat", to="anndata",assay = DefaultAssay(sample23_ATAC),
outFile='../../data/scATAC-seq/sample23/sample23_scATAC-seq_95k_processed.h5ad')
?convertFormat
??convertFormat
sparse_mtx <- sample23_ATAC@assays$ATAC@counts
chrom_assay <- CreateChromatinAssay(
counts = sparse_mtx,
sep = c("-", "-"),
genome = 'hg38',
min.cells = 10,
min.features = 200
)
sample23_ATAC <- CreateSeuratObject(
counts = chrom_assay,
assay = "peaks",
meta.data = as.data.frame(sample23_ATAC@meta.data)
)
sceasy::convertFormat(sample23_ATAC, from="seurat", to="anndata",assay = DefaultAssay(sample23_ATAC),
outFile='../../data/scATAC-seq/sample23/sample23_scATAC-seq_95k_processed.h5ad')
rm(list = ls()[str_which(ls(),'sample')])
gc()
#sample24----
sample24_ATAC <- readRDS('../../data/scATAC-seq/Sample24/sample24_scATAC-seq_100k_healthy_processed.Rds')
sample24_ATAC
sceasy::convertFormat(sample24_ATAC, from="seurat", to="anndata",assay = 'peaks',
outFile='../../data/scATAC-seq/sample24/sample24_scATAC-seq_52k_processed.h5ad')
